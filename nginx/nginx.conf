# 서버 블록을 정의합니다.
server {
    # 80번 포트에서 수신 대기합니다.
    listen 80;
    server_name localhost;

    # 요청 본문 크기 제한을 설정합니다. (필요에 따라 조절)
    client_max_body_size 10M;

    # Next.js 서버로 요청을 전달하는 location 블록입니다.
    location / {
        # Dockerfile에서 복사한 standalone 서버 경로를 가리킵니다.
        # Next.js는 기본적으로 3000번 포트에서 실행됩니다.
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_read_timeout 60s;
        proxy_connect_timeout 60s;
    }

    # 정적 파일 캐싱 설정 (브라우저 캐시 활용)
    # Next.js가 빌드 시 해시 기반으로 파일명을 생성하므로 강력한 캐싱을 적용해도 안전합니다.
    location /_next/static {
        add_header Cache-Control "public, max-age=31536000, immutable";
    }

    # 기타 정적 파일 (public 폴더 안의 파일들)
    location /static {
         add_header Cache-Control "public, max-age=31536000, immutable";
    }
}